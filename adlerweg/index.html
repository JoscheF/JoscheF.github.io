<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>basemap.at mit leaflet-hash Plugin</title>

    <link rel="stylesheet" href="js/leaflet/leaflet.css" />
	<link rel="stylesheet" href="js/leaflet-elevation/leaflet.elevation-0.0.4.css" />
    <script src="js/leaflet/leaflet.js"></script>
    <script src="js/leaflet-hash/leaflet-hash.js"></script>
	<script src="js/leaflet-elevation/leaflet.elevation-0.0.4.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
	
    <style>
        body {
            padding: 0px;
            margin: 0px;
        }
        html, body, #map {
            height: 600px;
            width: 1024px;
        }
    </style>
</head>

<body>
	<h3>Adlerweg-Etappe 15: Solsteinhaus – Leutasch</h3>
    <div id="map"></div>

    <script>
        // WMTS-Layer basemap.at - Quelle: http://www.basemap.at/wmts/1.0.0/WMTSCapabilities.xml
        var layers = {
            geolandbasemap: L.tileLayer("https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
            }),
            bmapgrau: L.tileLayer("https://{s}.wien.gv.at/basemap/bmapgrau/normal/google3857/{z}/{y}/{x}.png", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
            }),
            bmapoverlay: L.tileLayer("https://{s}.wien.gv.at/basemap/bmapoverlay/normal/google3857/{z}/{y}/{x}.png", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
            }),
            bmaphidpi: L.tileLayer("https://{s}.wien.gv.at/basemap/bmaphidpi/normal/google3857/{z}/{y}/{x}.jpeg", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
            }),
            bmaporthofoto30cm: L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
            }),
            osm: L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                subdomains: ['a', 'b', 'c'],
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            })
        };

        // Karte definieren
        var map = L.map('map', {
            layers: [layers.geolandbasemap],
            center : [47.654, 13.370],
            zoom : 8
        });

        // Maßstab hinzufügen
        L.control.scale({
            maxWidth: 200,
            metric: true,
            imperial: false
        }).addTo(map);

		 // Höhenprofil control hinzufügen
        var profileControl = L.control.elevation({
            position : 'bottomleft',
            theme : 'steelblue-theme'
        });
        profileControl.addTo(map);

        // GPX Track laden
        gpxTrack = omnivore.gpx('gpx/AdlerwegEtappe15.gpx').addTo(map);
		
        // nach erfolgreichem Laden Popup hinzufügen, Ausschnitt setzen und Höhenprofil erzeugen
        gpxTrack.on('ready', function () {
            // Popup hinzufügen
            var markup = '<h3>Adlerweg-Etappe 15: Solsteinhaus – Leutasch</h3>';
            markup += '<p>Mitten durchs Karwendel führt diese Etappe und verläuft über die Eppzirler Scharte in das Leutaschtal und weiter zu den 24 Weilern der Gemeinde Leutasch. Dabei werden Almgebiete, Mischwälder und die Gießenbachklamm durchquert.</p>'
            markup += '<li>Ausgangspunkt: Solsteinhaus</li>';
            markup += '<li>Endpunkt: Leutasch/Ahrn</li>';
            markup += '<li>Höhenmeter bergauf: 870</li>';
            markup += '<li>Höhenmeter bergab: 1530</li>';
            markup += '<li>Höchster Punkt: 2110</li>';
            markup += '<li>Schwierigkeitsgrad: mittelschwierig</li>';
            markup += '<li>Streckenlänge (in km): 20</li>';
            markup += '<li>Gehzeit (in Stunden): 6,5</li>';
            markup += '<li>Einkehrmöglichkeiten: Solsteinhaus, Eppzirleralm</li>';
            markup += '<li><a href="http://www.tirol.at/reisefuehrer/sport/wandern/wandertouren/a-adlerweg-etappe-15-solsteinhaus-leutasch">Weitere Informationen</a></li>';
            gpxTrack.bindPopup(markup, { maxWidth : 450 });

            // Ausschnitt setzen
            map.fitBounds(gpxTrack.getBounds());

            // Höhenprofil erzeugen
            gpxTrack.eachLayer(function(layer) {
                profileControl.addData(layer.feature);
            });
        });

        // WMTS-Layer Auswahl hinzufügen
        var layerControl = L.control.layers({
            "basemap.at - STANDARD": layers.geolandbasemap,
            "basemap.at - GRAU": layers.bmapgrau,
            "basemap.at - OVERLAY": layers.bmapoverlay,
            "basemap.at - HIGH-DPI": layers.bmaphidpi,
            "basemap.at - ORTHOFOTO": layers.bmaporthofoto30cm,
            "OpenStreetMap": layers.osm,
        }).addTo(map);

        // leaflet-hash aktivieren
        var hash = new L.Hash(map);
		

		var huts = [
			L.marker([47.30805, 11.28811], { title: "Solsteinhaus", icon: L.icon( {iconUrl: 'icons/hut.png'} )} ),
			L.marker([47.33112, 11.26743], { title: "Eppzirleralm", icon: L.icon( {iconUrl: 'icons/hut.png'} )} )
		
		];
		
		var hutsLayer = L.featureGroup();
		for (var i=0; i<huts.length; i++) {
			hutsLayer.addLayer(huts[i]);
		}
		//hutsLayer.addTo(map);
		map.on("zoomend", function() {
			if (map.getZoom() >= 15) {
				map.addLayer(hutsLayer);
			} else {
				map.removeLayer(hutsLayer);
			}
			
		});
		
		
    </script>

</body>

</html>
